{"version":3,"sources":["ReactNativeZoomableView.tsx"],"names":["React","Component","createRef","Animated","InteractionManager","PanResponder","StyleSheet","View","AnimatedTouchFeedback","DebugTouchPoint","calcGestureCenterPoint","calcGestureTouchDistance","calcNewScaledOffsetForZoomCentering","applyPanBoundariesToOffset","getBoundaryCrossedAnim","getPanMomentumDecayAnim","getZoomToAnimation","initialState","originalWidth","originalHeight","originalPageX","originalPageY","ReactNativeZoomableView","constructor","props","ValueXY","x","y","Value","value","boundaryCrossedAnimInEffect","runAfterInteractions","setTimeout","zoomSubjectWrapperRef","current","measureInWindow","width","height","setState","e","gestureState","onStartShouldSetPanResponder","_getZoomableViewEventObject","onLongPress","longPressTimeout","longPressDuration","onPanResponderGrant","panAnim","stopAnimation","zoomAnim","gestureStarted","gestureType","_resolveAndHandleTap","debugPoints","lastGestureCenterPosition","disablePanOnInitialZoom","zoomLevel","initialZoom","vx","vy","start","clearTimeout","onPanResponderEnd","onZoomEnd","onShiftingEnd","onPanResponderMove","numberActiveTouches","_handlePanResponderGrant","_handlePanResponderEnd","lastGestureTouchDistance","_handlePinching","Math","abs","dx","dy","isShiftGesture","_handleShifting","now","Date","doubleTapFirstTapReleaseTimestamp","doubleTapDelay","_addTouch","doubleTapFirstTap","id","toString","isSecondTap","singleTapTimeoutId","_handleDoubleTap","nativeEvent","pageX","state","pageY","persist","onSingleTap","gestureHandlers","create","_handleStartShouldSetPanResponder","_handlePanResponderMove","onPanResponderRelease","onPanResponderTerminate","evt","onPanResponderTerminationRequest","onShouldBlockNativeResponder","zoomAnimatedValue","panAnimatedValueXY","offsetX","initialOffsetX","offsetY","initialOffsetY","setValue","addListener","__setOffset","__getOffset","axis","offset","offsetState","__offsets","animValue","bindToBorders","containerSize","contentSize","contentWidth","contentHeight","boundOffset","panBoundaryPadding","boundariesApplied","toFixed","componentDidUpdate","prevProps","prevState","zoomEnabled","onTransformInvocationInitialized","_invokeOnTransform","successful","currState","originalMeasurementsChanged","componentDidMount","grabZoomSubjectOriginalMeasurements","measureZoomSubjectInterval","setInterval","componentWillUnmount","clearInterval","zoomableViewEvent","onTransform","overwriteObj","maxZoom","minZoom","pinchToZoomInSensitivity","pinchToZoomOutSensitivity","distance","onZoomBefore","zoomGrowthFromLastGestureState","pinchToZoomSensitivity","deltaGrowth","deltaGrowthAdjustedBySensitivity","newZoomLevel","gestureCenterPoint","zoomCenter","debug","_setPinchDebugPoints","oldOffsetX","oldOffsetY","oldScale","newScale","offsetShift","_calcOffsetShiftSinceLastGestureState","onZoomAfter","gestureResponderEvent","points","touches","movementSensibility","shift","shiftX","shiftY","moveX","moveY","_setNewOffsetPosition","newOffsetX","newOffsetY","onShiftingBefore","onShiftingAfter","touch","push","_removeTouch","splice","indexOf","onDoubleTapBefore","onDoubleTapAfter","doubleTapZoomToCenter","nextZoomStep","_getNextZoomStep","zoomPositionCoordinates","_zoomToLocation","then","zoomStep","prevScale","listenerId","removeListener","zoomTo","zoomBy","zoomLevelChange","moveTo","moveBy","offsetChangeX","offsetChangeY","render","styles","container","panHandlers","zoomSubject","style","transform","scale","getTranslateTransform","children","visualTouchFeedbackEnabled","map","animationDuration","index","undefined","flex","justifyContent","alignItems","position","overflow"],"mappings":"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","sourcesContent":["import React, { Component, createRef, RefObject } from 'react';\nimport {\n  Animated,\n  GestureResponderEvent,\n  InteractionManager,\n  PanResponder,\n  PanResponderGestureState,\n  StyleSheet,\n  View,\n} from 'react-native';\n\nimport {\n  Vec2D,\n  ReactNativeZoomableViewProps,\n  ReactNativeZoomableViewState,\n  TouchPoint,\n  ZoomableViewEvent,\n} from './typings';\n\nimport { AnimatedTouchFeedback } from './components';\nimport { DebugTouchPoint } from './debugHelper';\nimport {\n  calcGestureCenterPoint,\n  calcGestureTouchDistance,\n  calcNewScaledOffsetForZoomCentering,\n} from './helper';\nimport { applyPanBoundariesToOffset } from './helper/applyPanBoundariesToOffset';\nimport {\n  getBoundaryCrossedAnim,\n  getPanMomentumDecayAnim,\n  getZoomToAnimation,\n} from './animations';\n\nconst initialState = {\n  originalWidth: null,\n  originalHeight: null,\n  originalPageX: null,\n  originalPageY: null,\n} as ReactNativeZoomableViewState;\n\nclass ReactNativeZoomableView extends Component<\n  ReactNativeZoomableViewProps,\n  ReactNativeZoomableViewState\n> {\n  zoomSubjectWrapperRef: RefObject<View>;\n  gestureHandlers: any;\n  doubleTapFirstTapReleaseTimestamp: number;\n\n  static defaultProps = {\n    zoomEnabled: true,\n    initialZoom: 1,\n    initialOffsetX: 0,\n    initialOffsetY: 0,\n    maxZoom: 1.5,\n    minZoom: 0.5,\n    pinchToZoomInSensitivity: 1,\n    pinchToZoomOutSensitivity: 1,\n    movementSensibility: 1,\n    doubleTapDelay: 300,\n    bindToBorders: true,\n    zoomStep: 0.5,\n    onLongPress: null,\n    longPressDuration: 700,\n    contentWidth: undefined,\n    contentHeight: undefined,\n    panBoundaryPadding: 0,\n    visualTouchFeedbackEnabled: true,\n    disablePanOnInitialZoom: false,\n  };\n\n  private panAnim = new Animated.ValueXY({ x: 0, y: 0 });\n  private zoomAnim = new Animated.Value(1);\n\n  private __offsets = {\n    x: {\n      value: 0,\n      boundaryCrossedAnimInEffect: false,\n    },\n    y: {\n      value: 0,\n      boundaryCrossedAnimInEffect: false,\n    },\n  };\n\n  private zoomLevel = 1;\n  private lastGestureCenterPosition: { x: number; y: number } = null;\n  private lastGestureTouchDistance: number;\n  private gestureType: 'pinch' | 'shift' | 'null';\n  private gestureStarted = false;\n\n  /**\n   * Last press time (used to evaluate whether user double tapped)\n   * @type {number}\n   */\n  private longPressTimeout: NodeJS.Timeout = null;\n  private onTransformInvocationInitialized: boolean;\n  private singleTapTimeoutId: NodeJS.Timeout;\n  private touches: TouchPoint[] = [];\n  private doubleTapFirstTap: TouchPoint;\n  private measureZoomSubjectInterval: NodeJS.Timer;\n\n  constructor(props) {\n    super(props);\n\n    this.gestureHandlers = PanResponder.create({\n      onStartShouldSetPanResponder: this._handleStartShouldSetPanResponder,\n      onPanResponderGrant: this._handlePanResponderGrant,\n      onPanResponderMove: this._handlePanResponderMove,\n      onPanResponderRelease: this._handlePanResponderEnd,\n      onPanResponderTerminate: (evt, gestureState) => {\n        // We should also call _handlePanResponderEnd\n        // to properly perform cleanups when the gesture is terminated\n        // (aka gesture handling responsibility is taken over by another component).\n        // This also fixes a weird issue where\n        // on real device, sometimes onPanResponderRelease is not called when you lift 2 fingers up,\n        // but onPanResponderTerminate is called instead for no apparent reason.\n        this._handlePanResponderEnd(evt, gestureState);\n        this.props.onPanResponderTerminate?.(\n          evt,\n          gestureState,\n          this._getZoomableViewEventObject()\n        );\n      },\n      onPanResponderTerminationRequest: (evt, gestureState) =>\n        !!this.props.onPanResponderTerminationRequest?.(\n          evt,\n          gestureState,\n          this._getZoomableViewEventObject()\n        ),\n      onShouldBlockNativeResponder: (evt, gestureState) =>\n        !!this.props.onShouldBlockNativeResponder?.(\n          evt,\n          gestureState,\n          this._getZoomableViewEventObject()\n        ) ?? true,\n    });\n\n    this.zoomSubjectWrapperRef = createRef<View>();\n\n    if (this.props.zoomAnimatedValue)\n      this.zoomAnim = this.props.zoomAnimatedValue;\n    if (this.props.panAnimatedValueXY)\n      this.panAnim = this.props.panAnimatedValueXY;\n\n    this.zoomLevel = props.initialZoom;\n    this.offsetX = props.initialOffsetX;\n    this.offsetY = props.initialOffsetY;\n\n    this.panAnim.setValue({ x: this.offsetX, y: this.offsetY });\n    this.zoomAnim.setValue(this.zoomLevel);\n    this.panAnim.addListener(({ x, y }) => {\n      this.offsetX = x;\n      this.offsetY = y;\n    });\n    this.zoomAnim.addListener(({ value }) => {\n      this.zoomLevel = value;\n    });\n\n    this.state = {\n      ...initialState,\n    };\n\n    this.lastGestureTouchDistance = 150;\n\n    this.gestureType = null;\n  }\n\n  private set offsetX(x: number) {\n    this.__setOffset('x', x);\n  }\n  private set offsetY(y: number) {\n    this.__setOffset('y', y);\n  }\n  private get offsetX() {\n    return this.__getOffset('x');\n  }\n  private get offsetY() {\n    return this.__getOffset('y');\n  }\n  private __setOffset(axis: 'x' | 'y', offset) {\n    const offsetState = this.__offsets[axis];\n    const animValue = this.panAnim?.[axis];\n\n    if (this.props.bindToBorders) {\n      const containerSize =\n        axis === 'x' ? this.state?.originalWidth : this.state?.originalHeight;\n      const contentSize =\n        axis === 'x'\n          ? this.props.contentWidth || this.state?.originalWidth\n          : this.props.contentHeight || this.state?.originalHeight;\n\n      const boundOffset =\n        contentSize && containerSize\n          ? applyPanBoundariesToOffset(\n              offset,\n              containerSize,\n              contentSize,\n              this.zoomLevel,\n              this.props.panBoundaryPadding\n            )\n          : offset;\n\n      if (\n        animValue &&\n        !this.gestureType &&\n        !offsetState.boundaryCrossedAnimInEffect\n      ) {\n        const boundariesApplied =\n          boundOffset !== offset &&\n          boundOffset.toFixed(3) !== offset.toFixed(3);\n        if (boundariesApplied) {\n          offsetState.boundaryCrossedAnimInEffect = true;\n          getBoundaryCrossedAnim(this.panAnim[axis], boundOffset).start(() => {\n            offsetState.boundaryCrossedAnimInEffect = false;\n          });\n          return;\n        }\n      }\n    }\n\n    offsetState.value = offset;\n  }\n  private __getOffset(axis: 'x' | 'y') {\n    return this.__offsets[axis].value;\n  }\n\n  componentDidUpdate(\n    prevProps: ReactNativeZoomableViewProps,\n    prevState: ReactNativeZoomableViewState\n  ) {\n    const { zoomEnabled, initialZoom } = this.props;\n    if (prevProps.zoomEnabled && !zoomEnabled) {\n      this.zoomLevel = initialZoom;\n      this.zoomAnim.setValue(this.zoomLevel);\n    }\n    if (\n      !this.onTransformInvocationInitialized &&\n      this._invokeOnTransform().successful\n    ) {\n      this.panAnim.addListener(() => this._invokeOnTransform());\n      this.zoomAnim.addListener(() => this._invokeOnTransform());\n      this.onTransformInvocationInitialized = true;\n    }\n\n    const currState = this.state;\n    const originalMeasurementsChanged =\n      currState.originalHeight !== prevState.originalHeight ||\n      currState.originalWidth !== prevState.originalWidth ||\n      currState.originalPageX !== prevState.originalPageX ||\n      currState.originalPageY !== prevState.originalPageY;\n\n    if (this.onTransformInvocationInitialized && originalMeasurementsChanged) {\n      this._invokeOnTransform();\n    }\n  }\n\n  componentDidMount() {\n    this.grabZoomSubjectOriginalMeasurements();\n    // We've already run `grabZoomSubjectOriginalMeasurements` at various events\n    // to make sure the measurements are promptly updated.\n    // However, there might be cases we haven't accounted for, especially when\n    // native processes are involved. To account for those cases,\n    // we'll use an interval here to ensure we're always up-to-date.\n    // The `setState` in `grabZoomSubjectOriginalMeasurements` won't trigger a rerender\n    // if the values given haven't changed, so we're not running performance risk here.\n    this.measureZoomSubjectInterval = setInterval(\n      this.grabZoomSubjectOriginalMeasurements,\n      1e3\n    );\n  }\n\n  componentWillUnmount() {\n    clearInterval(this.measureZoomSubjectInterval);\n  }\n\n  /**\n   * try to invoke onTransform\n   * @private\n   */\n  _invokeOnTransform() {\n    const zoomableViewEvent = this._getZoomableViewEventObject();\n\n    if (!zoomableViewEvent.originalWidth || !zoomableViewEvent.originalHeight)\n      return { successful: false };\n\n    this.props.onTransform?.(zoomableViewEvent);\n\n    return { successful: true };\n  }\n\n  /**\n   * Returns additional information about components current state for external event hooks\n   *\n   * @returns {{}}\n   * @private\n   */\n  _getZoomableViewEventObject(overwriteObj = {}): ZoomableViewEvent {\n    return {\n      zoomLevel: this.zoomLevel,\n      offsetX: this.offsetX,\n      offsetY: this.offsetY,\n      originalHeight: this.state.originalHeight,\n      originalWidth: this.state.originalWidth,\n      originalPageX: this.state.originalPageX,\n      originalPageY: this.state.originalPageY,\n      ...overwriteObj,\n    } as ZoomableViewEvent;\n  }\n\n  /**\n   * Get the original box dimensions and save them for later use.\n   * (They will be used to calculate boxBorders)\n   *\n   * @private\n   */\n  private grabZoomSubjectOriginalMeasurements = () => {\n    // make sure we measure after animations are complete\n    InteractionManager.runAfterInteractions(() => {\n      // this setTimeout is here to fix a weird issue on iOS where the measurements are all `0`\n      // when navigating back (react-navigation stack) from another view\n      // while closing the keyboard at the same time\n      setTimeout(() => {\n        // In normal conditions, we're supposed to measure zoomSubject instead of its wrapper.\n        // However, our zoomSubject may have been transformed by an initial zoomLevel or offset,\n        // in which case these measurements will not represent the true \"original\" measurements.\n        // We just need to make sure the zoomSubjectWrapper perfectly aligns with the zoomSubject\n        // (no border, space, or anything between them)\n        const zoomSubjectWrapperRef = this.zoomSubjectWrapperRef;\n        // we don't wanna measure when zoomSubjectWrapperRef is not yet available or has been unmounted\n        zoomSubjectWrapperRef.current?.measureInWindow(\n          (x, y, width, height) => {\n            this.setState({\n              originalWidth: width,\n              originalHeight: height,\n              originalPageX: x,\n              originalPageY: y,\n            });\n          }\n        );\n      });\n    });\n  };\n\n  /**\n   * Handles the start of touch events and checks for taps\n   *\n   * @param e\n   * @param gestureState\n   * @returns {boolean}\n   *\n   * @private\n   */\n  _handleStartShouldSetPanResponder = (\n    e: GestureResponderEvent,\n    gestureState: PanResponderGestureState\n  ) => {\n    if (this.props.onStartShouldSetPanResponder) {\n      this.props.onStartShouldSetPanResponder(\n        e,\n        gestureState,\n        this._getZoomableViewEventObject(),\n        false\n      );\n    }\n\n    // Always set pan responder on start\n    // of gesture so we can handle tap.\n    // \"Pan threshold validation\" will be handled\n    // in `onPanResponderMove` instead of in `onMoveShouldSetPanResponder`\n    return true;\n  };\n\n  /**\n   * Calculates pinch distance\n   *\n   * @param e\n   * @param gestureState\n   * @private\n   */\n  _handlePanResponderGrant = (e, gestureState) => {\n    if (this.props.onLongPress) {\n      this.longPressTimeout = setTimeout(() => {\n        this.props.onLongPress?.(\n          e,\n          gestureState,\n          this._getZoomableViewEventObject()\n        );\n        this.longPressTimeout = null;\n      }, this.props.longPressDuration);\n    }\n\n    this.props.onPanResponderGrant?.(\n      e,\n      gestureState,\n      this._getZoomableViewEventObject()\n    );\n\n    this.panAnim.stopAnimation();\n    this.zoomAnim.stopAnimation();\n    this.gestureStarted = true;\n  };\n\n  /**\n   * Handles the end of touch events\n   *\n   * @param e\n   * @param gestureState\n   *\n   * @private\n   */\n  _handlePanResponderEnd = (e, gestureState) => {\n    if (!this.gestureType) {\n      this._resolveAndHandleTap(e);\n    }\n\n    this.setState({ debugPoints: [] });\n\n    this.lastGestureCenterPosition = null;\n\n    // Trigger final shift animation unless disablePanOnInitialZoom is set and we're on the initial zoom level\n    if (\n      !(\n        this.gestureType === 'shift' &&\n        this.props.disablePanOnInitialZoom &&\n        this.zoomLevel === this.props.initialZoom\n      )\n    ) {\n      getPanMomentumDecayAnim(this.panAnim, {\n        x: gestureState.vx / this.zoomLevel,\n        y: gestureState.vy / this.zoomLevel,\n      }).start();\n    }\n\n    if (this.longPressTimeout) {\n      clearTimeout(this.longPressTimeout);\n      this.longPressTimeout = null;\n    }\n\n    this.props.onPanResponderEnd?.(\n      e,\n      gestureState,\n      this._getZoomableViewEventObject()\n    );\n\n    if (this.gestureType === 'pinch') {\n      this.props.onZoomEnd?.(\n        e,\n        gestureState,\n        this._getZoomableViewEventObject()\n      );\n    } else if (this.gestureType === 'shift') {\n      this.props.onShiftingEnd?.(\n        e,\n        gestureState,\n        this._getZoomableViewEventObject()\n      );\n    }\n\n    this.gestureType = null;\n    this.gestureStarted = false;\n  };\n\n  /**\n   * Handles the actual movement of our pan responder\n   *\n   * @param e\n   * @param gestureState\n   *\n   * @private\n   */\n  _handlePanResponderMove = (\n    e: GestureResponderEvent,\n    gestureState: PanResponderGestureState\n  ) => {\n    if (this.props.onPanResponderMove) {\n      if (\n        this.props.onPanResponderMove(\n          e,\n          gestureState,\n          this._getZoomableViewEventObject()\n        )\n      ) {\n        return false;\n      }\n    }\n\n    // Only supports 2 touches and below,\n    // any invalid number will cause the gesture to end.\n    if (gestureState.numberActiveTouches <= 2) {\n      if (!this.gestureStarted) {\n        this._handlePanResponderGrant(e, gestureState);\n      }\n    } else {\n      if (this.gestureStarted) {\n        this._handlePanResponderEnd(e, gestureState);\n      }\n      return true;\n    }\n\n    if (gestureState.numberActiveTouches === 2) {\n      if (this.longPressTimeout) {\n        clearTimeout(this.longPressTimeout);\n        this.longPressTimeout = null;\n      }\n\n      // change some measurement states when switching gesture to ensure a smooth transition\n      if (this.gestureType !== 'pinch') {\n        this.lastGestureCenterPosition = calcGestureCenterPoint(\n          e,\n          gestureState\n        );\n        this.lastGestureTouchDistance = calcGestureTouchDistance(\n          e,\n          gestureState\n        );\n      }\n      this.gestureType = 'pinch';\n      this._handlePinching(e, gestureState);\n    } else if (gestureState.numberActiveTouches === 1) {\n      if (\n        this.longPressTimeout &&\n        (Math.abs(gestureState.dx) > 5 || Math.abs(gestureState.dy) > 5)\n      ) {\n        clearTimeout(this.longPressTimeout);\n        this.longPressTimeout = null;\n      }\n      // change some measurement states when switching gesture to ensure a smooth transition\n      if (this.gestureType !== 'shift') {\n        this.lastGestureCenterPosition = calcGestureCenterPoint(\n          e,\n          gestureState\n        );\n      }\n\n      const { dx, dy } = gestureState;\n      const isShiftGesture = Math.abs(dx) > 2 || Math.abs(dy) > 2;\n      if (isShiftGesture) {\n        this.gestureType = 'shift';\n        this._handleShifting(gestureState);\n      }\n    }\n  };\n\n  /**\n   * Handles the pinch movement and zooming\n   *\n   * @param e\n   * @param gestureState\n   *\n   * @private\n   */\n  _handlePinching(\n    e: GestureResponderEvent,\n    gestureState: PanResponderGestureState\n  ) {\n    if (!this.props.zoomEnabled) return;\n\n    const {\n      maxZoom,\n      minZoom,\n      pinchToZoomInSensitivity,\n      pinchToZoomOutSensitivity,\n    } = this.props;\n\n    const distance = calcGestureTouchDistance(e, gestureState);\n\n    if (\n      this.props.onZoomBefore &&\n      this.props.onZoomBefore(\n        e,\n        gestureState,\n        this._getZoomableViewEventObject()\n      )\n    ) {\n      return;\n    }\n\n    // define the new zoom level and take zoom level sensitivity into consideration\n    const zoomGrowthFromLastGestureState =\n      distance / this.lastGestureTouchDistance;\n    this.lastGestureTouchDistance = distance;\n\n    const pinchToZoomSensitivity =\n      zoomGrowthFromLastGestureState < 1\n        ? pinchToZoomOutSensitivity\n        : pinchToZoomInSensitivity;\n\n    const deltaGrowth = zoomGrowthFromLastGestureState - 1;\n    // 0 - no resistance\n    // 10 - 90% resistance\n    const deltaGrowthAdjustedBySensitivity =\n      deltaGrowth * (1 - (pinchToZoomSensitivity * 9) / 100);\n\n    let newZoomLevel = this.zoomLevel * (1 + deltaGrowthAdjustedBySensitivity);\n\n    // make sure max and min zoom levels are respected\n    if (maxZoom !== null && newZoomLevel > maxZoom) {\n      newZoomLevel = maxZoom;\n    }\n\n    if (newZoomLevel < minZoom) {\n      newZoomLevel = minZoom;\n    }\n\n    const gestureCenterPoint = calcGestureCenterPoint(e, gestureState);\n\n    if (!gestureCenterPoint) return;\n\n    const zoomCenter = {\n      x: gestureCenterPoint.x - this.state.originalPageX,\n      y: gestureCenterPoint.y - this.state.originalPageY,\n    };\n\n    // Uncomment to debug\n    this.props.debug && this._setPinchDebugPoints(e, zoomCenter);\n\n    const { originalHeight, originalWidth } = this.state;\n\n    const oldOffsetX = this.offsetX;\n    const oldOffsetY = this.offsetY;\n    const oldScale = this.zoomLevel;\n    const newScale = newZoomLevel;\n\n    let offsetY = calcNewScaledOffsetForZoomCentering(\n      oldOffsetY,\n      originalHeight,\n      oldScale,\n      newScale,\n      zoomCenter.y\n    );\n    let offsetX = calcNewScaledOffsetForZoomCentering(\n      oldOffsetX,\n      originalWidth,\n      oldScale,\n      newScale,\n      zoomCenter.x\n    );\n\n    const offsetShift =\n      this._calcOffsetShiftSinceLastGestureState(gestureCenterPoint);\n    if (offsetShift) {\n      offsetX += offsetShift.x;\n      offsetY += offsetShift.y;\n    }\n\n    this.offsetX = offsetX;\n    this.offsetY = offsetY;\n    this.zoomLevel = newScale;\n\n    this.panAnim.setValue({ x: this.offsetX, y: this.offsetY });\n    this.zoomAnim.setValue(this.zoomLevel);\n\n    this.props.onZoomAfter?.(\n      e,\n      gestureState,\n      this._getZoomableViewEventObject()\n    );\n  }\n\n  /**\n   * Used to debug pinch events\n   * @param gestureResponderEvent\n   * @param zoomCenter\n   * @param points\n   */\n  _setPinchDebugPoints(\n    gestureResponderEvent: GestureResponderEvent,\n    zoomCenter: Vec2D,\n    ...points: Vec2D[]\n  ) {\n    const { touches } = gestureResponderEvent.nativeEvent;\n    const { originalPageY, originalPageX } = this.state;\n    this.setState({\n      debugPoints: [\n        {\n          x: touches[0].pageX - originalPageX,\n          y: touches[0].pageY - originalPageY,\n        },\n        {\n          x: touches[1].pageX - originalPageX,\n          y: touches[1].pageY - originalPageY,\n        },\n        zoomCenter,\n        ...points,\n      ],\n    });\n  }\n\n  /**\n   * Calculates the amount the offset should shift since the last position during panning\n   *\n   * @param {Vec2D} gestureCenterPoint\n   *\n   * @private\n   */\n  _calcOffsetShiftSinceLastGestureState(gestureCenterPoint: Vec2D) {\n    const { movementSensibility } = this.props;\n\n    let shift = null;\n\n    if (this.lastGestureCenterPosition) {\n      const dx = gestureCenterPoint.x - this.lastGestureCenterPosition.x;\n      const dy = gestureCenterPoint.y - this.lastGestureCenterPosition.y;\n\n      const shiftX = dx / this.zoomLevel / movementSensibility;\n      const shiftY = dy / this.zoomLevel / movementSensibility;\n\n      shift = {\n        x: shiftX,\n        y: shiftY,\n      };\n    }\n\n    this.lastGestureCenterPosition = gestureCenterPoint;\n\n    return shift;\n  }\n\n  /**\n   * Handles movement by tap and move\n   *\n   * @param gestureState\n   *\n   * @private\n   */\n  _handleShifting(gestureState: PanResponderGestureState) {\n    // Skips shifting if disablePanOnInitialZoom is set and we're on the initial zoom level\n    if (\n      this.props.disablePanOnInitialZoom &&\n      this.zoomLevel === this.props.initialZoom\n    ) {\n      return;\n    }\n    const shift = this._calcOffsetShiftSinceLastGestureState({\n      x: gestureState.moveX,\n      y: gestureState.moveY,\n    });\n    if (!shift) return;\n\n    const offsetX = this.offsetX + shift.x;\n    const offsetY = this.offsetY + shift.y;\n\n    if (this.props.debug) {\n      const x = gestureState.moveX - this.state.originalPageX;\n      const y = gestureState.moveY - this.state.originalPageY;\n      this.setState({ debugPoints: [{ x, y }] });\n    }\n\n    this._setNewOffsetPosition(offsetX, offsetY);\n  }\n\n  /**\n   * Set the state to offset moved\n   *\n   * @param {number} newOffsetX\n   * @param {number} newOffsetY\n   * @returns\n   */\n  async _setNewOffsetPosition(newOffsetX: number, newOffsetY: number) {\n    const { onShiftingBefore, onShiftingAfter } = this.props;\n\n    if (onShiftingBefore?.(null, null, this._getZoomableViewEventObject())) {\n      return;\n    }\n\n    this.offsetX = newOffsetX;\n    this.offsetY = newOffsetY;\n\n    this.panAnim.setValue({ x: this.offsetX, y: this.offsetY });\n    this.zoomAnim.setValue(this.zoomLevel);\n\n    onShiftingAfter?.(null, null, this._getZoomableViewEventObject());\n  }\n\n  /**\n   * Check whether the press event is double tap\n   * or single tap and handle the event accordingly\n   *\n   * @param e\n   *\n   * @private\n   */\n  private _resolveAndHandleTap = (e: GestureResponderEvent) => {\n    const now = Date.now();\n    if (\n      this.doubleTapFirstTapReleaseTimestamp &&\n      now - this.doubleTapFirstTapReleaseTimestamp < this.props.doubleTapDelay\n    ) {\n      this._addTouch({\n        ...this.doubleTapFirstTap,\n        id: now.toString(),\n        isSecondTap: true,\n      });\n      clearTimeout(this.singleTapTimeoutId);\n      delete this.doubleTapFirstTapReleaseTimestamp;\n      delete this.singleTapTimeoutId;\n      delete this.doubleTapFirstTap;\n      this._handleDoubleTap(e);\n    } else {\n      this.doubleTapFirstTapReleaseTimestamp = now;\n      this.doubleTapFirstTap = {\n        id: now.toString(),\n        x: e.nativeEvent.pageX - this.state.originalPageX,\n        y: e.nativeEvent.pageY - this.state.originalPageY,\n      };\n      this._addTouch(this.doubleTapFirstTap);\n\n      // persist event so e.nativeEvent is preserved after a timeout delay\n      e.persist();\n      this.singleTapTimeoutId = setTimeout(() => {\n        delete this.doubleTapFirstTapReleaseTimestamp;\n        delete this.singleTapTimeoutId;\n        this.props.onSingleTap?.(e, this._getZoomableViewEventObject());\n      }, this.props.doubleTapDelay);\n    }\n  };\n\n  private _addTouch(touch: TouchPoint) {\n    this.touches.push(touch);\n    this.setState({ touches: [...this.touches] });\n  }\n\n  private _removeTouch(touch: TouchPoint) {\n    this.touches.splice(this.touches.indexOf(touch), 1);\n    this.setState({ touches: [...this.touches] });\n  }\n\n  /**\n   * Handles the double tap event\n   *\n   * @param e\n   *\n   * @private\n   */\n  _handleDoubleTap(e: GestureResponderEvent) {\n    const { onDoubleTapBefore, onDoubleTapAfter, doubleTapZoomToCenter } =\n      this.props;\n\n    onDoubleTapBefore?.(e, this._getZoomableViewEventObject());\n\n    const nextZoomStep = this._getNextZoomStep();\n    const { originalPageX, originalPageY } = this.state;\n\n    // define new zoom position coordinates\n    const zoomPositionCoordinates = {\n      x: e.nativeEvent.pageX - originalPageX,\n      y: e.nativeEvent.pageY - originalPageY,\n    };\n\n    // if doubleTapZoomToCenter enabled -> always zoom to center instead\n    if (doubleTapZoomToCenter) {\n      zoomPositionCoordinates.x = 0;\n      zoomPositionCoordinates.y = 0;\n    }\n\n    this._zoomToLocation(\n      zoomPositionCoordinates.x,\n      zoomPositionCoordinates.y,\n      nextZoomStep\n    ).then(() => {\n      onDoubleTapAfter?.(\n        e,\n        this._getZoomableViewEventObject({ zoomLevel: nextZoomStep })\n      );\n    });\n  }\n\n  /**\n   * Returns the next zoom step based on current step and zoomStep property.\n   * If we are zoomed all the way in -> return to initialzoom\n   *\n   * @returns {*}\n   */\n  _getNextZoomStep() {\n    const { zoomStep, maxZoom, initialZoom } = this.props;\n    const { zoomLevel } = this;\n\n    if (zoomLevel.toFixed(2) === maxZoom.toFixed(2)) {\n      return initialZoom;\n    }\n\n    const nextZoomStep = zoomLevel * (1 + zoomStep);\n    if (nextZoomStep > maxZoom) {\n      return maxZoom;\n    }\n\n    return nextZoomStep;\n  }\n\n  /**\n   * Zooms to a specific location in our view\n   *\n   * @param x\n   * @param y\n   * @param newZoomLevel\n   *\n   * @private\n   */\n  async _zoomToLocation(x: number, y: number, newZoomLevel: number) {\n    if (!this.props.zoomEnabled) return;\n\n    this.props.onZoomBefore?.(null, null, this._getZoomableViewEventObject());\n\n    // == Perform Zoom Animation ==\n    // Calculates panAnim values based on changes in zoomAnim.\n    let prevScale = this.zoomLevel;\n    // Since zoomAnim is calculated in native driver,\n    //  it will jitter panAnim once in a while,\n    //  because here panAnim is being calculated in js.\n    // However the jittering should mostly occur in simulator.\n    const listenerId = this.zoomAnim.addListener(({ value: newScale }) => {\n      this.panAnim.setValue({\n        x: calcNewScaledOffsetForZoomCentering(\n          this.offsetX,\n          this.state.originalWidth,\n          prevScale,\n          newScale,\n          x\n        ),\n        y: calcNewScaledOffsetForZoomCentering(\n          this.offsetY,\n          this.state.originalHeight,\n          prevScale,\n          newScale,\n          y\n        ),\n      });\n      prevScale = newScale;\n    });\n    getZoomToAnimation(this.zoomAnim, newZoomLevel).start(() => {\n      this.zoomAnim.removeListener(listenerId);\n    });\n    // == Zoom Animation Ends ==\n\n    this.props.onZoomAfter?.(null, null, this._getZoomableViewEventObject());\n  }\n\n  /**\n   * Zooms to a specificied zoom level.\n   * Returns a promise if everything was updated and a boolean, whether it could be updated or if it exceeded the min/max zoom limits.\n   *\n   * @param {number} newZoomLevel\n   *\n   * @return {Promise<bool>}\n   */\n  async zoomTo(newZoomLevel: number): Promise<boolean> {\n    if (\n      // if we would go out of our min/max limits -> abort\n      newZoomLevel > this.props.maxZoom ||\n      newZoomLevel < this.props.minZoom\n    )\n      return false;\n\n    await this._zoomToLocation(0, 0, newZoomLevel);\n    return true;\n  }\n\n  /**\n   * Zooms in or out by a specified change level\n   * Use a positive number for `zoomLevelChange` to zoom in\n   * Use a negative number for `zoomLevelChange` to zoom out\n   *\n   * Returns a promise if everything was updated and a boolean, whether it could be updated or if it exceeded the min/max zoom limits.\n   *\n   * @param {number | null} zoomLevelChange\n   *\n   * @return {Promise<bool>}\n   */\n  zoomBy(zoomLevelChange: number = null): Promise<boolean> {\n    // if no zoom level Change given -> just use zoom step\n    if (!zoomLevelChange) {\n      zoomLevelChange = this.props.zoomStep;\n    }\n\n    return this.zoomTo(this.zoomLevel + zoomLevelChange);\n  }\n\n  /**\n   * Moves the zoomed view to a specified position\n   * Returns a promise when finished\n   *\n   * @param {number} newOffsetX the new position we want to move it to (x-axis)\n   * @param {number} newOffsetY the new position we want to move it to (y-axis)\n   *\n   * @return {Promise<bool>}\n   */\n  moveTo(newOffsetX: number, newOffsetY: number): Promise<void> {\n    const { originalWidth, originalHeight } = this.state;\n\n    const offsetX = (newOffsetX - originalWidth / 2) / this.zoomLevel;\n    const offsetY = (newOffsetY - originalHeight / 2) / this.zoomLevel;\n\n    return this._setNewOffsetPosition(-offsetX, -offsetY);\n  }\n\n  /**\n   * Moves the zoomed view by a certain amount.\n   *\n   * Returns a promise when finished\n   *\n   * @param {number} offsetChangeX the amount we want to move the offset by (x-axis)\n   * @param {number} offsetChangeY the amount we want to move the offset by (y-axis)\n   *\n   * @return {Promise<bool>}\n   */\n  moveBy(offsetChangeX: number, offsetChangeY: number): Promise<void> {\n    const offsetX =\n      (this.offsetX * this.zoomLevel - offsetChangeX) / this.zoomLevel;\n    const offsetY =\n      (this.offsetY * this.zoomLevel - offsetChangeY) / this.zoomLevel;\n\n    return this._setNewOffsetPosition(offsetX, offsetY);\n  }\n\n  render() {\n    return (\n      <View\n        style={styles.container}\n        {...this.gestureHandlers.panHandlers}\n        ref={this.zoomSubjectWrapperRef}\n        onLayout={this.grabZoomSubjectOriginalMeasurements}\n      >\n        <Animated.View\n          style={[\n            styles.zoomSubject,\n            this.props.style,\n            {\n              transform: [\n                { scale: this.zoomAnim },\n                ...this.panAnim.getTranslateTransform(),\n              ],\n            },\n          ]}\n        >\n          {this.props.children}\n        </Animated.View>\n        {this.props.visualTouchFeedbackEnabled &&\n          this.state.touches?.map((touch) => {\n            const animationDuration = this.props.doubleTapDelay;\n            return (\n              <AnimatedTouchFeedback\n                x={touch.x}\n                y={touch.y}\n                key={touch.id}\n                animationDuration={animationDuration}\n                onAnimationDone={() => this._removeTouch(touch)}\n              />\n            );\n          })}\n        {/* For Debugging Only */}\n        {(this.state.debugPoints || []).map(({ x, y }, index) => {\n          return <DebugTouchPoint key={index} x={x} y={y} />;\n        })}\n      </View>\n    );\n  }\n}\n\nconst styles = StyleSheet.create({\n  zoomSubject: {\n    flex: 1,\n    width: '100%',\n    justifyContent: 'center',\n    alignItems: 'center',\n  },\n  container: {\n    flex: 1,\n    justifyContent: 'center',\n    alignItems: 'center',\n    position: 'relative',\n    overflow: 'hidden',\n  },\n});\n\nexport default ReactNativeZoomableView;\n"]}